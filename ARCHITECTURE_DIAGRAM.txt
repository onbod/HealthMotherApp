╔══════════════════════════════════════════════════════════════════════════════╗
║                      HEALTHYMAMA SYSTEM ARCHITECTURE                         ║
╚══════════════════════════════════════════════════════════════════════════════╝

┌──────────────────────────────────────────────────────────────────────────────┐
│                             CLIENT LAYER                                     │
├──────────────────────────────────────────────────────────────────────────────┤
│                                                                              │
│  ┌────────────────────────────┐           ┌─────────────────────────────┐   │
│  │   Mobile App (Flutter)    │           │  Admin Dashboard (Next.js) │   │
│  ├────────────────────────────┤           ├─────────────────────────────┤   │
│  │  • Patient Login          │           │  • Clinician Management     │   │
│  │  • ANC Visit Tracking     │           │  • Patient Monitoring      │   │
│  │  • Appointment Scheduling │           │  • Analytics Dashboard     │   │
│  │  • Medication Reminders   │           │  • Quality Indicators      │   │
│  │  • Health Education       │           │  • Reports & Reports       │   │
│  │  • Offline Support        │           │  • DAK Compliance          │   │
│  └────────────────────────────┘           └─────────────────────────────┘   │
│                                                                              │
└─────────────────────┬─────────────────────────┬─────────────────────────────┘
                      │                          │
                      │ HTTPS/REST API           │
                      │ JWT Authentication       │
                      │                          │
┌─────────────────────▼─────────────────────────▼─────────────────────────────┐
│                         API GATEWAY LAYER                                    │
├──────────────────────────────────────────────────────────────────────────────┤
│                                                                              │
│                       Express.js API Server                                  │
│                         (Railway Platform)                                   │
│                                                                              │
│  ┌───────────────────────────────────────────────────────────────────────┐ │
│  │                        Authentication Module                           │ │
│  │  • POST /login/request-otp      • POST /login/verify-otp             │ │
│  │  • POST /login/direct            • GET  /user/session                 │ │
│  └───────────────────────────────────────────────────────────────────────┘ │
│                                                                              │
│  ┌───────────────────────────────────────────────────────────────────────┐ │
│  │                        Patient Management                              │ │
│  │  • GET  /patient               • GET  /patient/:id                   │ │
│  │  • GET  /pregnancy              • GET  /encounter                      │ │
│  └───────────────────────────────────────────────────────────────────────┘ │
│                                                                              │
│  ┌───────────────────────────────────────────────────────────────────────┐ │
│  │                        ANC Visit Tracking                             │ │
│  │  • GET  /anc_visit             • GET  /anc_visit/:id                  │ │
│  │  • GET  /anc_visit/:patient_id  • DAK Decision Support                │ │
│  └───────────────────────────────────────────────────────────────────────┘ │
│                                                                              │
│  ┌───────────────────────────────────────────────────────────────────────┐ │
│  │                        Delivery & Postnatal                           │ │
│  │  • GET  /delivery              • GET  /neonate                       │ │
│  │  • GET  /postnatal_care        • GET  /neonate/:id                   │ │
│  └───────────────────────────────────────────────────────────────────────┘ │
│                                                                              │
│  ┌───────────────────────────────────────────────────────────────────────┐ │
│  │                        Clinical Data                                  │ │
│  │  • GET  /observation           • GET  /condition                    │ │
│  │  • GET  /procedure             • GET  /medication_statement         │ │
│  └───────────────────────────────────────────────────────────────────────┘ │
│                                                                              │
│  ┌───────────────────────────────────────────────────────────────────────┐ │
│  │                        DAK Integration                                │ │
│  │  • GET  /dak/decision-support/:id                                     │ │
│  │  • GET  /dak/scheduling/:id                                           │ │
│  │  • GET  /dak/quality-metrics                                          │ │
│  └───────────────────────────────────────────────────────────────────────┘ │
│                                                                              │
└─────────────────────┬─────────────────────────────────────────────────────┘
                      │
                      │ PostgreSQL Queries
                      │ Connection Pool
                      │
┌─────────────────────▼───────────────────────────────────────────────────────┐
│                           DATA LAYER                                         │
├──────────────────────────────────────────────────────────────────────────────┤
│                         PostgreSQL Database                                  │
│                        (Railway Hosted)                                       │
│                                                                              │
│  ┌───────────────────────────────────────────────────────────────────────┐  │
│  │                    CORE TABLES                                       │  │
│  │  • organization        • encounter     • patient                     │  │
│  │  • pregnancy          • anc_visit     • delivery                   │  │
│  │  • neonate            • postnatal_care                               │  │
│  └───────────────────────────────────────────────────────────────────────┘  │
│                                                                              │
│  ┌───────────────────────────────────────────────────────────────────────┐  │
│  │                    CLINICAL TABLES                                    │  │
│  │  • observation        • condition      • procedure                  │  │
│  │  • medication_statement                                             │  │
│  └───────────────────────────────────────────────────────────────────────┘  │
│                                                                              │
│  ┌───────────────────────────────────────────────────────────────────────┐  │
│  │                    DAK TABLES                                         │  │
│  │  • dak_contact_schedule           • dak_risk_assessment            │  │
│  │  • dak_quality_indicators         • dak_configuration             │  │
│  └───────────────────────────────────────────────────────────────────────┘  │
│                                                                              │
│  ┌───────────────────────────────────────────────────────────────────────┐  │
│  │                    ADMIN TABLES                                        │  │
│  │  • admin               • report       • chat_threads                │  │
│  │  • notifications      • tips         • fhir_resources             │  │
│  └───────────────────────────────────────────────────────────────────────┘  │
│                                                                              │
└──────────────────────────────────────────────────────────────────────────────┘

╔══════════════════════════════════════════════════════════════════════════════╗
║                        AUTHENTICATION FLOW                                  ║
╚══════════════════════════════════════════════════════════════════════════════╝

    Mobile App                   Backend API                Database
         │                            │                         │
         │──── Request OTP ────────────▶│                       │
         │                            │                         │
         │                            │─── Verify User ────────▶│
         │                            │                         │
         │◀─── Return OTP ────────────│                         │
         │     (123456)                │                         │
         │                            │                         │
         │──── Verify OTP ────────────▶│                       │
         │   + OTP Code                │                         │
         │                            │─── Validate OTP ───────▶│
         │                            │                         │
         │◀─── JWT Token ─────────────│                         │
         │   (Stored Securely)         │                         │
         │                            │                         │
         │──── GET /user/session ─────▶│                         │
         │   + JWT Token               │                         │
         │                            │─── Validate JWT ───────▶│
         │                            │                         │
         │                            │─── Fetch Data ─────────▶│
         │                            │     • Patient           │
         │                            │     • Pregnancy         │
         │                            │     • ANC Visits        │
         │                            │     • Delivery          │
         │                            │◀── Return Data ────────│
         │                            │                         │
         │◀─── Complete Session ─────│                         │
         │                            │                         │

╔══════════════════════════════════════════════════════════════════════════════╗
║                        DATA FLOW ARCHITECTURE                                ║
╚══════════════════════════════════════════════════════════════════════════════╝

                    ┌──────────────────────┐
                    │  User Interactions   │
                    │  • Login             │
                    │  • View ANC History  │
                    │  • Schedule Visit    │
                    │  • View Medications  │
                    └──────────┬───────────┘
                               │
                               ▼
                    ┌──────────────────────┐
                    │   Flutter Provider   │
                    │   State Management   │
                    └──────────┬───────────┘
                               │
                               ▼
                    ┌──────────────────────┐
                    │   API Service Layer  │
                    │   • HTTP Calls      │
                    │   • Error Handling  │
                    │   • Token Mgmt      │
                    └──────────┬───────────┘
                               │
                               ▼
                    ┌──────────────────────┐
                    │   Express.js Router  │
                    │   • Endpoint Handler │
                    │   • JWT Validation   │
                    │   • Request Parsing  │
                    └──────────┬───────────┘
                               │
                               ▼
                    ┌──────────────────────┐
                    │   Database Service   │
                    │   • SQL Queries      │
                    │   • Joins & Filters  │
                    │   • Transactions     │
                    └──────────┬───────────┘
                               │
                               ▼
                    ┌──────────────────────┐
                    │   PostgreSQL DB      │
                    │   • Data Storage     │
                    │   • Indexes          │
                    │   • Constraints      │
                    └──────────────────────┘

╔══════════════════════════════════════════════════════════════════════════════╗
║                        DEPLOYMENT ARCHITECTURE                              ║
╚══════════════════════════════════════════════════════════════════════════════╝

                        ┌─────────────────────┐
                        │   Vercel CDN       │
                        │   (Admin Dashboard)│
                        └──────────┬──────────┘
                                    │
                        ┌──────────▼──────────┐
                        │   Railway Platform   │
                        │  ┌────────────────┐ │
                        │  │  Node.js API   │ │
                        │  │  Server        │ │
                        │  └────────┬───────┘ │
                        │           │         │
                        │  ┌────────▼───────┐ │
                        │  │  PostgreSQL   │ │
                        │  │  Database     │ │
                        │  └───────────────┘ │
                        └──────────┬─────────┘
                                   │
                        ┌──────────▼──────────┐
                        │   Mobile Devices    │
                        │   (Android/iOS)     │
                        │   Flutter App       │
                        └─────────────────────┘

╔══════════════════════════════════════════════════════════════════════════════╗
║                        SECURITY ARCHITECTURE                                ║
╚══════════════════════════════════════════════════════════════════════════════╝

┌──────────────────────────────────────────────────────────────────────────────┐
│                          SECURITY LAYERS                                      │
├──────────────────────────────────────────────────────────────────────────────┤
│                                                                              │
│  1. Transport Security                                                       │
│     • HTTPS/TLS encryption                                                  │
│     • Certificate validation                                                │
│                                                                              │
│  2. Authentication                                                           │
│     • Multi-method auth (Phone/ID/NIN)                                      │
│     • OTP verification                                                      │
│     • JWT token generation                                                   │
│                                                                              │
│  3. Authorization                                                            │
│     • Role-based access control                                              │
│     • Token expiry (2 hours)                                                │
│     • Secure token storage                                                   │
│                                                                              │
│  4. Data Security                                                            │
│     • Input validation                                                       │
│     • SQL injection prevention                                               │
│     • XSS protection                                                         │
│                                                                              │
│  5. Privacy                                                                   │
│     • Patient data encryption                                                │
│     • Secure local storage                                                   │
│     • HIPAA compliance (FHIR)                                                │
│                                                                              │
└──────────────────────────────────────────────────────────────────────────────┘

╔══════════════════════════════════════════════════════════════════════════════╗
║                        DATABASE RELATIONSHIPS                               ║
╚══════════════════════════════════════════════════════════════════════════════╝

    organization (1:N) encounter
                           │
                           │ (1:N)
                           ▼
                    anc_visit, observation,
                    condition, procedure,
                    medication_statement
                           │
    patient (1:N) pregnancy │
                           │ (1:1)
                           ▼
                      delivery (1:N) neonate
                           │ (1:N)
                           ▼
                    postnatal_care

╔══════════════════════════════════════════════════════════════════════════════╗
║                          SUPPORTING DIAGRAMS                                ║
╚══════════════════════════════════════════════════════════════════════════════╝

Component Interactions:
    
    [Mobile] ──HTTPS──> [API] ──SQL──> [DB]
       ↑                   │              │
       │                   │              │
       └─────JWT──<────────┴──────────────┘

Deployment Stack:
    
    [Frontend] ──> [Backend] ──> [Database]
      Vercel         Railway         Railway

Technology Stack:
    
    Flutter + Next.js + Node.js + PostgreSQL + Railway + Vercel
        │         │         │          │          │        │
        │         │         │          │          │        │
     Mobile    Admin     API        Data     Cloud   Static
     Apps      Panel     Server     Store     Host    CDN
